<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f7f6;
      padding: 20px;
    }
    h1 {
      color: #4CAF50;
    }
    select, button, input {
      font-size: 16px;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      border: 1px solid #ccc;
      width: 100%;
    }
    #loading {
      display: none;
      color: green;
    }
    #statusMessage {
      color: red;
      margin-top: 20px;
    }
    #csvUpload {
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>Generate CSV</h1>

  <!-- Team input box -->
  <label for="teamInput">Team:</label>
  <input type="text" id="teamInput" readonly />

  <!-- Application Name input box -->
  <label for="appNameInput">App Name:</label>
  <input type="text" id="appNameInput" readonly />

  <!-- Date input box -->
  <label for="dateInput">Date:</label>
  <input type="text" id="dateInput" readonly />

  <!-- Month input box -->
  <label for="monthInput">Month:</label>
  <input type="text" id="monthInput" readonly />

  <!-- Year input box -->
  <label for="yearInput">Year:</label>
  <input type="text" id="yearInput" readonly />

  <!-- CSV Upload -->
  <label for="csvUpload">Upload CSV:</label>
  <input type="file" id="csvUpload" />

  <!-- Generate CSV button -->
  <button id="generateCsvButton" onclick="generateCsv()">Generate CSV</button>

  <p id="loading">Loading applications, please wait...</p>
  
  <div id="statusMessage"></div>

  <script>
    // Function to load applications and populate input boxes
    function loadApplications() {
      document.getElementById('loading').style.display = 'block';
      console.log("Fetching applications from server...");
      
      google.script.run.withSuccessHandler(function(applications) {
        document.getElementById('loading').style.display = 'none';

        if (applications.length === 0) {
          document.getElementById('statusMessage').innerText = "No applications found!";
          return;
        }

        let dropdown = document.getElementById('appDropdown');
        applications.forEach(function(app) {
          let option = document.createElement('option');
          option.value = JSON.stringify({
            appId: app.appId, 
            engagementId: app.engagementId,
            name: app.name,
            team: app.team
          }); 
          option.text = app.name;
          dropdown.add(option);
        });

        // Auto-populate the first application's data
        if (applications.length > 0) {
          const firstApp = applications[0];
          document.getElementById('teamInput').value = firstApp.team;
          document.getElementById('appNameInput').value = firstApp.name;
        }

        // Populate date, month, and year fields with current date
        const today = new Date();
        document.getElementById('dateInput').value = today.getDate();
        document.getElementById('monthInput').value = today.toLocaleString('default', { month: 'long' });
        document.getElementById('yearInput').value = today.getFullYear();
      }).getApplications();
    }

    // Function to handle CSV generation
    function generateCsv() {
      let statusMessage = document.getElementById('statusMessage');

      // Check if a file has been uploaded
      const csvFile = document.getElementById('csvUpload').files[0];
      if (!csvFile) {
        statusMessage.innerText = "Please upload a CSV file!";
        statusMessage.style.color = "red";
        return;
      }

      // Display a generating message
      statusMessage.innerText = "Generating CSV, please wait...";
      statusMessage.style.color = "blue";

      // (Insert logic for handling CSV upload and report generation)

      statusMessage.innerText = "CSV generated successfully!";
      statusMessage.style.color = "green";
    }

    // Load the applications when the page loads
    document.addEventListener('DOMContentLoaded', loadApplications);
  </script>

</body>
</html>
